<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="width=500" name="viewport">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
    <meta charset="utf-8">
    <title>Sync Settings</title>
    <script>const d = document;
    let loc = false, locip;

    // https://www.educative.io/edpresso/how-to-dynamically-load-a-js-file-in-javascript
    function loadJS(FILE_URL, async = true) {
        let scE = d.createElement("script");
        scE.setAttribute("src", FILE_URL);
        scE.setAttribute("type", "text/javascript");
        scE.setAttribute("async", async);
        d.body.appendChild(scE);
        // success event
        scE.addEventListener("load", () => {
            //console.log("File loaded");
            GetV();
        });
        // error event
        scE.addEventListener("error", (ev) => {
            console.log("Error on loading file", ev);
            alert("Loading of configuration script failed.\nIncomplete page data!");
        });
    }

    function S() {
        const url = (loc ? `http://${locip}` : '') + '/settings/s.js?p=4';
        loadJS(url, false);	// If we set async false, file is loaded and executed, then next statement is processed
    }
    </script>
</head>

<body class="m-8" onload="S()">
<hyd-m-header></hyd-m-header>
<form id="form_s" method="post" name="Sf">
    <h2 class="mb-6 text-lg font-bold text-gray-500">MQTT setup</h2>
    <fieldset class="mb-4">
        <div class="md:flex mb-6">
            <label class="md:w-2/3 block text-gray-500 font-bold">
                <input class="mr-2 leading-tight" id="MQ" name="MQ" type="checkbox">
                <span class="text-sm">
        Enable MQTT
      </span>
            </label>
        </div>
        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="MS">
                Network name (SSID, empty to not connect)
            </label>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                   id="MS"
                   name="MS"
                   placeholder="Broker" type="text">
        </div>
        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="MQPORT">
                Access Point WiFi channel
            </label>
            <input class="shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                   id="MQPORT"
                   max="65535"
                   min="1"
                   name="MQPORT"
                   required type="number">
        </div>
        <div role="alert">
            <div class="bg-red-500 text-white font-bold rounded-t px-4 py-2">
                WARNING
            </div>
            <div class="border border-t-0 border-red-400 rounded-b bg-red-100 px-4 py-3 text-red-700">
                <p>The MQTT credentials are sent over an unsecured connection.<br>
                    Never use the MQTT password for another service!</p>
            </div>
        </div>
        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="MQUSER">
                Username
            </label>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                   id="MQUSER"
                   maxlength="40"
                   name="MQUSER" placeholder="Username" type="text">
        </div>
        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="MQPASS">
                Password
            </label>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                   id="MQPASS"
                   name="MQPASS"
                   placeholder="******************" type="password">
        </div>
        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="MQCID">
                Client ID
            </label>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                   id="MQCID"
                   maxlength="40"
                   name="MQCID" placeholder="Client ID" type="text">
        </div>
        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="MD">
                Device Topic
            </label>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                   id="MD"
                   maxlength="32"
                   name="MD" placeholder="Device Topic" type="text">
        </div>
        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="MG">
                Group Topic
            </label>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                   id="MG"
                   maxlength="32"
                   name="MG" placeholder="Group Topic" type="text">
        </div>
        <i>Reboot required to apply changes.</i>
    </fieldset>
    <button class="btn-primary" type="submit">
        Save & Connect
    </button>
</form>
</body>

</html>
